#include <WiFi.h>


//Red
const char* ssid = "Web Libre"; 
//Reemplazar por el nombre de la red a conectarse 


const char* password = "00000000"; 
//Reemplazar por la contrasena
const int verde = 13; //Pines de cada led
const int blanco = 23;

WiFiServer server(80); //el servidor web

void setup() {
//Inicializar el puerto serie 
//Inicializar el puerto serie
  Serial.begin(115200);
  pinMode(verde, OUTPUT);
  pinMode(blanco,OUTPUT);
  digitalWrite(verde, LOW);
  digitalWrite(blanco, LOW);


  //configurar pines de salida
  //pinMode(Led1,OUTPUT);
  //pinMode(Led2,OUTPUT);

  Serial.printf("Conectando a: %s\n ", ssid);
  WiFi.begin(ssid,password);

//Intentar siempre conectarse a la red

  while(WiFi.status()!= WL_CONNECTED){
    Serial.printf("Conectando");
    delay(500);
  }

    server.begin();
    Serial.println("Server started");

    Serial.printf("Conectado a %s\n", ssid);
    Serial.print("Direccion IP del modulo: ");
    Serial.println(WiFi.localIP());
  
}

void loop() {
  // put your main code here, to run repeatedly:
  WiFiClient client = server.available();
  if (!client) {
    return;
  }

  while(!client.available()) {
    delay(1);
  }

  String request = client.readStringUntil('\r');
  if (request.indexOf("/favicon") == -1) {
    Serial.println("New client");
    Serial.println(request);
  }
  //client.flush();

  int value = LOW;
  if (request.indexOf("/LED=ON") != -1) {
    digitalWrite(verde, HIGH);
    digitalWrite(blanco, HIGH);
    value = HIGH;
  }
  if (request.indexOf("/LED=OFF") != -1) {
    digitalWrite(verde,LOW);
    digitalWrite(blanco,LOW);
    value = LOW;
  }

  client.println("HTTP/1.1 200 OK");
  client.println("Content-Type: text/html");
  client.println("");
  client.println("<!DOCTYPE HTML>");
  client.println("<html>");

  client.print("Led pin is now: ");

  if(value == HIGH) {
    client.print("On");
  } else {
    client.print("Off");
  }
  client.println("<br><br>");
  client.println("<a href=\"/LED=ON\"\"><button>Turn On </button></a>");
  client.println("<a href=\"/LED=OFF\"\"><button>Turn Off </button></a><br />");
  client.println("</html>");

  delay(1);
  //if (request.indexOf("/favicon") == -1) Serial.println("Client disonnected\n");
//digitalWrite(23, HIGH);
//delay(300);
//digitalWrite(23, LOW);
//delay(300);
  /*digitalWrite(blanco, HIGH);
  delay(1000);
  digitalWrite(blanco, LOW);
  delay(1000);
  digitalWrite(verde,HIGH);
  delay(1000);
  digitalWrite(verde, LOW);
  delay(1000);*/
}

//Se verifica y luego se instala, loop se ejecuta indefinidamente.
